terraform {
  required_providers {
    lacework = {
      source = "lacework/lacework"
    }
  }
}

resource "lacework_vulnerability_exception_container" "fixable_unset" {
  name        = var.name
  description = var.description
  expiry      = var.expiry
  reason      = "Accepted Risk"
  vulnerability_criteria {
    severities = ["Info", "Low"]
    cves       = var.cves
    package {
      name    = var.package_name
      version = var.package_version
    }
    package {
      name    = "adm-zip"
      version = "0.4.7"
    }
  }

  resource_scope {
    image_ids    = ["sha256:3b83d9104a4c4ccf76433756f14a2ad109e2aae15444b63339"]
    image_tags   = ["4.0", "1.0", "3.1", "5.0"]
    namespaces   = ["debian"]
    registries   = ["index.docker.io"]
    repositories = ["lacework/lacework-cli"]
  }
}

variable "name" {
  type    = string
  default = "Terraform Container Vulnerability Exception"
}

variable "description" {
  type    = string
  default = "Container Vulnerability Exception created by Terraform"
}

variable "expiry" {
  type    = string
  default = "2023-06-06T15:55:15Z"
}

variable "package_name" {
  type    = string
  default = "myPackage"
}

variable "package_version" {
  type    = string
  default = "1.0.0"
}

variable "cves" {
  type    = list(string)
  default = ["CVE-2016-9840", "cve-2018-14599", "CVE-2018-6942"]
}
