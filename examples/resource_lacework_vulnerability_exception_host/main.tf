terraform {
  required_providers {
    lacework = {
      source = "lacework/lacework"
    }
  }
}

resource "lacework_vulnerability_exception_host" "example" {
  name = var.name
  description = var.description
  enabled = true
  reason = "Accepted Risk"
  vulnerability_criteria {
    severities = ["Critical"]
    cves = var.cves
    package {
      name = var.package_name
      version = var.package_version
    }
    package {
      name = "myPackage"
      version = "2.0.0"
    }
    package {
      name = "myOtherPackage"
      version = "1.0.0"
    }
    fixable = true
  }
  resource_scope {
    hostnames = ["host1", "host2"]
    cluster_names = ["clust-abc", "clust-xyz"]
    external_ips  = ["210.12.100.5"]
    namespaces = ["namespace1", "namespace2"]
  }
  expiration_time = "2023-01-19T23:26:10Z"
}

variable "name" {
  type = string
  default = "Terraform Host Vulnerability Exception"
}

variable "description" {
  type = string
  default = "Host Vulnerability Exception created by Terraform"
}

variable "package_name" {
  type = string
  default = "myPackage"
}

variable "package_version" {
  type = string
  default = "1.0.0"
}

variable "cves" {
  type = list(string)
  default = ["CVE-2016-9840", "cve-2018-14599", "CVE-2018-6942"]
}

output "name" {
  value = lacework_vulnerability_exception_host.example.name
}

output "description" {
  value = lacework_vulnerability_exception_host.example.description
}

output "cves" {
  value = lacework_vulnerability_exception_host.example.vulnerability_criteria.0.cves
}

output "packages" {
  value = lacework_vulnerability_exception_host.example.vulnerability_criteria.0.package
}
